{% extends "base.html" %}

{% block title %}Creatives - Digital-SSP{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Creatives</h1>
    <p class="subtitle">Manage creative assets and versions</p>
    <div class="actions">
        <button class="btn btn-primary" onclick="showUploadCreativeModal()">+ Upload Creative</button>
        <button class="btn btn-secondary">Bulk Upload</button>
    </div>
</div>

<!-- CREATIVE LIBRARY -->
<div class="card">
    <div class="card-header">
        <h2>Creative Assets</h2>
    </div>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; padding: 24px;">
        {% for creative in creatives %}
        <div style="border: 1px solid #dadce0; border-radius: 8px; overflow: hidden; background: #fff; transition: all 0.2s;">
            <div style="width: 100%; height: 200px; background: linear-gradient(135deg, #1967d2 0%, #34a853 100%); display: flex; align-items: center; justify-content: center; color: #fff; font-size: 14px; font-weight: 500;">
                {{ creative.size }} {{ creative.creative_type }}
            </div>
            <div style="padding: 16px;">
                <h4 style="margin: 0 0 8px 0; font-size: 14px; font-weight: 500;">{{ creative.creative_name }}</h4>
                <div style="font-size: 12px; color: #5f6368; margin-bottom: 12px;">
                    <div>Advertiser: {{ creative.advertiser_name }}</div>
                    <div>Status: {{ creative.status }}</div>
                    <div>Approval: {{ creative.approval_status }}</div>
                    <div>Delivered: {{ "{:,}".format(creative.delivered or 0) }} Â· CTR {{ creative.ctr }}% Â· CPM ${{ creative.cpm }}</div>
                </div>
                <div style="display: flex; gap: 8px;">
                    <button style="flex: 1; padding: 8px; background: #1967d2; color: #fff; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: 500;">View</button>
                    <button style="flex: 1; padding: 8px; background: #f1f3f4; border: 1px solid #dadce0; border-radius: 4px; cursor: pointer; font-size: 12px;">Edit</button>
                </div>
            </div>
        </div>
        {% else %}
        <div class="muted" style="grid-column: 1 / -1;">No creatives found.</div>
        {% endfor %}
    </div>
</div>

<!-- CREATIVE SPECIFICATIONS -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px;">
    <div class="card">
        <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 500;">ðŸ“¦ Display Creative Specs</h3>
        <div style="font-size: 13px; color: #5f6368; line-height: 1.6;">
            <div style="margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid #e8eaed;">
                <div style="font-weight: 500; color: #202124; margin-bottom: 4px;">Supported Formats</div>
                JPEG, PNG, GIF, WebP
            </div>
            <div style="margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid #e8eaed;">
                <div style="font-weight: 500; color: #202124; margin-bottom: 4px;">Max File Size</div>
                150 KB
            </div>
            <div style="margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid #e8eaed;">
                <div style="font-weight: 500; color: #202124; margin-bottom: 4px;">Common Sizes</div>
                728x90, 300x250, 300x600, 970x90, 320x50
            </div>
            <div>
                <div style="font-weight: 500; color: #202124; margin-bottom: 4px;">Animation Limit</div>
                15 seconds (GIF/animated PNG)
            </div>
        </div>
    </div>
    
    <div class="card">
        <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 500;">ðŸŽ¬ Video Creative Specs</h3>
        <div style="font-size: 13px; color: #5f6368; line-height: 1.6;">
            <div style="margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid #e8eaed;">
                <div style="font-weight: 500; color: #202124; margin-bottom: 4px;">Supported Formats</div>
                MP4, WebM, FLV, MOV
            </div>
            <div style="margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid #e8eaed;">
                <div style="font-weight: 500; color: #202124; margin-bottom: 4px;">Max File Size</div>
                500 MB
            </div>
            <div style="margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid #e8eaed;">
                <div style="font-weight: 500; color: #202124; margin-bottom: 4px;">Duration</div>
                6 seconds - 10 minutes
            </div>
            <div>
                <div style="font-weight: 500; color: #202124; margin-bottom: 4px;">Resolution</div>
                Min 640x360 (HD recommended)
            </div>
        </div>
    </div>
    
    <div class="card">
        <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 500;">ðŸ“„ Native Creative Specs</h3>
        <div style="font-size: 13px; color: #5f6368; line-height: 1.6;">
            <div style="margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid #e8eaed;">
                <div style="font-weight: 500; color: #202124; margin-bottom: 4px;">Required Fields</div>
                Headline, Description, Image, Click URL
            </div>
            <div style="margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid #e8eaed;">
                <div style="font-weight: 500; color: #202124; margin-bottom: 4px;">Image Dimensions</div>
                Min 300x200, Max 1200x628
            </div>
            <div style="margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid #e8eaed;">
                <div style="font-weight: 500; color: #202124; margin-bottom: 4px;">Text Limits</div>
                Headline: 50 chars, Desc: 150 chars
            </div>
            <div>
                <div style="font-weight: 500; color: #202124; margin-bottom: 4px;">JSON Metadata</div>
                Optional structured data
            </div>
        </div>
    </div>
</div>

<!-- UPLOAD CREATIVE MODAL -->
<div id="uploadCreativeModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; padding: 20px; overflow-y: auto;">
    <div style="background: #fff; border-radius: 8px; width: 100%; max-width: 800px; padding: 32px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); margin: 20px auto;">
        <h2 style="margin-bottom: 4px;">Upload Creative</h2>
        <p class="muted" style="margin-bottom: 24px;">Add a new creative asset to your library</p>
        
        <!-- CREATIVE TYPE SELECTOR -->
        <div style="margin-bottom: 24px;">
            <label style="display: block; font-weight: 500; margin-bottom: 12px;">Creative Type *</label>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;">
                <label style="display: flex; align-items: center; padding: 12px; border: 2px solid #dadce0; border-radius: 4px; cursor: pointer; background: #fff;">
                    <input type="radio" name="creative-type" value="display" checked style="margin-right: 8px;">
                    <span style="font-weight: 500;">ðŸ“¦ Display</span>
                </label>
                <label style="display: flex; align-items: center; padding: 12px; border: 2px solid #dadce0; border-radius: 4px; cursor: pointer;">
                    <input type="radio" name="creative-type" value="video" style="margin-right: 8px;">
                    <span style="font-weight: 500;">ðŸŽ¬ Video</span>
                </label>
                <label style="display: flex; align-items: center; padding: 12px; border: 2px solid #dadce0; border-radius: 4px; cursor: pointer;">
                    <input type="radio" name="creative-type" value="native" style="margin-right: 8px;">
                    <span style="font-weight: 500;">ðŸ“„ Native</span>
                </label>
            </div>
        </div>
        
        <!-- DISPLAY UPLOAD SECTION -->
        <div id="display-section" style="margin-bottom: 24px;">
            <h3 style="margin-bottom: 16px; font-size: 14px; font-weight: 600;">Display Creative Details</h3>
            
            <div style="margin-bottom: 16px;">
                <label style="display: block; font-weight: 500; margin-bottom: 8px;">Creative Name *</label>
                <input type="text" style="width: 100%; padding: 10px; border: 1px solid #dadce0; border-radius: 4px; font-size: 14px;" placeholder="e.g., Homepage Banner Q1">
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                <div>
                    <label style="display: block; font-weight: 500; margin-bottom: 8px;">Width (px) *</label>
                    <input type="number" style="width: 100%; padding: 10px; border: 1px solid #dadce0; border-radius: 4px; font-size: 14px;" placeholder="728">
                </div>
                <div>
                    <label style="display: block; font-weight: 500; margin-bottom: 8px;">Height (px) *</label>
                    <input type="number" style="width: 100%; padding: 10px; border: 1px solid #dadce0; border-radius: 4px; font-size: 14px;" placeholder="90">
                </div>
            </div>
            
            <div style="margin-bottom: 16px;">
                <label style="display: block; font-weight: 500; margin-bottom: 8px;">Image File *</label>
                <div style="border: 2px dashed #dadce0; border-radius: 8px; padding: 24px; text-align: center; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='#f1f3f4'" onmouseout="this.style.background='#fff'">
                    <div style="font-size: 32px; margin-bottom: 8px;">ðŸ“¤</div>
                    <div style="font-weight: 500; margin-bottom: 4px;">Drag and drop your image</div>
                    <div style="font-size: 12px; color: #5f6368;">or click to select (Max 150 KB)</div>
                </div>
            </div>
            
            <div style="margin-bottom: 16px;">
                <label style="display: block; font-weight: 500; margin-bottom: 8px;">Click-Through URL *</label>
                <input type="url" style="width: 100%; padding: 10px; border: 1px solid #dadce0; border-radius: 4px; font-size: 14px;" placeholder="https://example.com/campaign">
            </div>
        </div>
        
        <!-- VIDEO UPLOAD SECTION -->
        <div id="video-section" style="display: none; margin-bottom: 24px;">
            <h3 style="margin-bottom: 16px; font-size: 14px; font-weight: 600;">Video Creative Details</h3>
            
            <div style="margin-bottom: 16px;">
                <label style="display: block; font-weight: 500; margin-bottom: 8px;">Video Name *</label>
                <input type="text" style="width: 100%; padding: 10px; border: 1px solid #dadce0; border-radius: 4px; font-size: 14px;" placeholder="e.g., Product Demo">
            </div>
            
            <div style="margin-bottom: 16px;">
                <label style="display: block; font-weight: 500; margin-bottom: 8px;">Video File (MP4, WebM) *</label>
                <div style="border: 2px dashed #dadce0; border-radius: 8px; padding: 24px; text-align: center; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='#f1f3f4'" onmouseout="this.style.background='#fff'">
                    <div style="font-size: 32px; margin-bottom: 8px;">ðŸŽ¬</div>
                    <div style="font-weight: 500; margin-bottom: 4px;">Drag and drop your video</div>
                    <div style="font-size: 12px; color: #5f6368;">or click to select (Max 500 MB)</div>
                </div>
            </div>
            
            <div style="margin-bottom: 16px;">
                <label style="display: block; font-weight: 500; margin-bottom: 8px;">Thumbnail Image</label>
                <input type="file" style="width: 100%; padding: 10px; border: 1px solid #dadce0; border-radius: 4px; font-size: 14px;">
            </div>
            
            <div style="margin-bottom: 16px;">
                <label style="display: block; font-weight: 500; margin-bottom: 8px;">Click-Through URL *</label>
                <input type="url" style="width: 100%; padding: 10px; border: 1px solid #dadce0; border-radius: 4px; font-size: 14px;" placeholder="https://example.com/campaign">
            </div>
        </div>
        
        <!-- NATIVE UPLOAD SECTION -->
        <div id="native-section" style="display: none; margin-bottom: 24px;">
            <h3 style="margin-bottom: 16px; font-size: 14px; font-weight: 600;">Native Creative Details</h3>
            
            <div style="margin-bottom: 16px;">
                <label style="display: block; font-weight: 500; margin-bottom: 8px;">Headline *</label>
                <input type="text" maxlength="50" style="width: 100%; padding: 10px; border: 1px solid #dadce0; border-radius: 4px; font-size: 14px;" placeholder="Headline (max 50 chars)">
                <div style="font-size: 11px; color: #5f6368; margin-top: 4px;">0/50 characters</div>
            </div>
            
            <div style="margin-bottom: 16px;">
                <label style="display: block; font-weight: 500; margin-bottom: 8px;">Description *</label>
                <textarea maxlength="150" style="width: 100%; padding: 10px; border: 1px solid #dadce0; border-radius: 4px; font-size: 14px; resize: vertical; min-height: 80px;" placeholder="Description (max 150 chars)"></textarea>
                <div style="font-size: 11px; color: #5f6368; margin-top: 4px;">0/150 characters</div>
            </div>
            
            <div style="margin-bottom: 16px;">
                <label style="display: block; font-weight: 500; margin-bottom: 8px;">Image (300x200 - 1200x628) *</label>
                <input type="file" style="width: 100%; padding: 10px; border: 1px solid #dadce0; border-radius: 4px; font-size: 14px;">
            </div>
            
            <div style="margin-bottom: 16px;">
                <label style="display: block; font-weight: 500; margin-bottom: 8px;">Click-Through URL *</label>
                <input type="url" style="width: 100%; padding: 10px; border: 1px solid #dadce0; border-radius: 4px; font-size: 14px;" placeholder="https://example.com">
            </div>
        </div>
        
        <!-- ACTIONS -->
        <div style="display: flex; gap: 12px; justify-content: flex-end;">
            <button type="button" onclick="hideUploadCreativeModal()" class="btn btn-secondary">Cancel</button>
            <button type="submit" class="btn btn-primary">Upload Creative</button>
        </div>
    </div>
</div>

<!-- CREATE CREATIVE MODAL -->
<div id="uploadCreativeModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
    <div style="background: white; border-radius: 8px; padding: 24px; width: 90%; max-width: 600px; max-height: 90vh; overflow-y: auto;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2 style="margin: 0;">Upload New Creative</h2>
            <button onclick="hideUploadCreativeModal()" style="background: none; border: none; font-size: 24px; cursor: pointer;">âœ•</button>
        </div>
        
        <form id="createCreativeForm" onsubmit="handleCreateCreative(event)">
            <div style="margin-bottom: 16px;">
                <label style="display: block; margin-bottom: 4px; font-weight: 600;">Creative Name</label>
                <input type="text" name="creative_name" placeholder="e.g., Q1 Hero Banner" required style="width: 100%; padding: 8px; border: 1px solid #dadce0; border-radius: 4px;">
            </div>
            
            <div style="margin-bottom: 16px;">
                <label style="display: block; margin-bottom: 4px; font-weight: 600;">Campaign ID</label>
                <input type="number" name="campaign_id" placeholder="Campaign ID" required style="width: 100%; padding: 8px; border: 1px solid #dadce0; border-radius: 4px;">
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                <div>
                    <label style="display: block; margin-bottom: 4px; font-weight: 600;">Creative Type</label>
                    <select name="creative_type" style="width: 100%; padding: 8px; border: 1px solid #dadce0; border-radius: 4px;">
                        <option>BANNER</option>
                        <option>VIDEO</option>
                        <option>NATIVE</option>
                        <option>RICH_MEDIA</option>
                    </select>
                </div>
                <div>
                    <label style="display: block; margin-bottom: 4px; font-weight: 600;">Status</label>
                    <select name="status" style="width: 100%; padding: 8px; border: 1px solid #dadce0; border-radius: 4px;">
                        <option>ACTIVE</option>
                        <option>PAUSED</option>
                        <option>ARCHIVED</option>
                    </select>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                <div>
                    <label style="display: block; margin-bottom: 4px; font-weight: 600;">Width (px)</label>
                    <input type="number" name="width" placeholder="300" value="300" style="width: 100%; padding: 8px; border: 1px solid #dadce0; border-radius: 4px;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 4px; font-weight: 600;">Height (px)</label>
                    <input type="number" name="height" placeholder="250" value="250" style="width: 100%; padding: 8px; border: 1px solid #dadce0; border-radius: 4px;">
                </div>
            </div>
            
            <div style="margin-bottom: 16px;">
                <label style="display: block; margin-bottom: 4px; font-weight: 600;">File URL</label>
                <input type="url" name="file_url" placeholder="https://cdn.example.com/creative.jpg" style="width: 100%; padding: 8px; border: 1px solid #dadce0; border-radius: 4px;">
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 4px; font-weight: 600;">Approval Status</label>
                <select name="approval_status" style="width: 100%; padding: 8px; border: 1px solid #dadce0; border-radius: 4px;">
                    <option>APPROVED</option>
                    <option>PENDING_REVIEW</option>
                    <option>REJECTED</option>
                </select>
            </div>
            
            <div style="display: flex; gap: 12px; justify-content: flex-end;">
                <button type="button" onclick="hideUploadCreativeModal()" class="btn btn-secondary" style="padding: 8px 16px;">Cancel</button>
                <button type="submit" class="btn btn-primary" style="padding: 8px 16px;">Upload Creative</button>
            </div>
        </form>
        <div id="createCreativeMessage" style="margin-top: 12px; padding: 12px; border-radius: 4px; display: none;"></div>
    </div>
</div>

<script>
document.querySelectorAll('input[name="creative-type"]').forEach(radio => {
    radio.addEventListener('change', function() {
        document.getElementById('display-section').style.display = 'none';
        document.getElementById('video-section').style.display = 'none';
        document.getElementById('native-section').style.display = 'none';
        document.getElementById(this.value + '-section').style.display = 'block';
    });
});

function showUploadCreativeModal() {
    document.getElementById('uploadCreativeModal').style.display = 'flex';
}

function hideUploadCreativeModal() {
    document.getElementById('uploadCreativeModal').style.display = 'none';
    document.getElementById('createCreativeForm').reset();
    document.getElementById('createCreativeMessage').style.display = 'none';
}

async function handleCreateCreative(event) {
    event.preventDefault();
    const form = event.target;
    const msgDiv = document.getElementById('createCreativeMessage');
    
    try {
        const formData = new FormData(form);
        const data = Object.fromEntries(formData);
        
        // Convert string values to appropriate types
        data.campaign_id = parseInt(data.campaign_id);
        data.width = parseInt(data.width || 300);
        data.height = parseInt(data.height || 250);
        data.file_size = 0;
        
        const response = await fetch('/api/creatives/create', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (result.success) {
            msgDiv.style.background = '#e6f4ea';
            msgDiv.style.color = '#137333';
            msgDiv.textContent = 'âœ“ ' + result.message;
            msgDiv.style.display = 'block';
            setTimeout(() => {
                hideUploadCreativeModal();
                location.reload();
            }, 1500);
        } else {
            msgDiv.style.background = '#ffebee';
            msgDiv.style.color = '#c5221f';
            msgDiv.textContent = 'âœ• ' + (result.error || 'Error uploading creative');
            msgDiv.style.display = 'block';
        }
    } catch (error) {
        msgDiv.style.background = '#ffebee';
        msgDiv.style.color = '#c5221f';
        msgDiv.textContent = 'âœ• Error: ' + error.message;
        msgDiv.style.display = 'block';
    }
}
</script>
{% endblock %}
