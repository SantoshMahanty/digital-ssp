{% extends "base.html" %}

{% block title %}Pacing & Delivery Controls - Ad Manager 360{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Pacing & Delivery Controls</h1>
    <p class="subtitle">Manage delivery speed, daily caps, and catch-up logic</p>
</div>

<!-- PACING STRATEGIES OVERVIEW -->
<div class="card">
    <h2>â±ï¸ Delivery Pacing Strategies</h2>
    <p class="subtitle">Choose how ads distribute over the campaign lifetime</p>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 24px;">
        <!-- EVEN PACING -->
        <div style="border: 2px solid #dadce0; border-radius: 8px; padding: 20px;">
            <div style="font-size: 32px; margin-bottom: 12px;">ğŸ“Š</div>
            <h3 style="margin: 0 0 12px 0; font-size: 15px; font-weight: 600;">Even Pacing</h3>
            <p style="font-size: 13px; color: #5f6368; margin: 0 0 16px 0; line-height: 1.6;">
                Spread impressions evenly throughout the campaign duration. Delivers consistent daily volumes regardless of demand fluctuations.
            </p>
            <div style="background: #f1f3f4; padding: 12px; border-radius: 4px; margin-bottom: 12px;">
                <div style="font-size: 11px; color: #5f6368; margin-bottom: 4px;"><strong>Daily Target</strong></div>
                <div style="font-size: 13px; color: #202124;">Total Impressions Ã· Days</div>
            </div>
            <div style="font-size: 12px; color: #5f6368;">
                âœ“ Consistent delivery<br>
                âœ“ Predictable traffic<br>
                âœ“ Best for brand awareness
            </div>
        </div>

        <!-- FRONTLOADED PACING -->
        <div style="border: 2px solid #dadce0; border-radius: 8px; padding: 20px;">
            <div style="font-size: 32px; margin-bottom: 12px;">ğŸš€</div>
            <h3 style="margin: 0 0 12px 0; font-size: 15px; font-weight: 600;">Frontloaded Pacing</h3>
            <p style="font-size: 13px; color: #5f6368; margin: 0 0 16px 0; line-height: 1.6;">
                Deliver 50% of impressions in the first half, then smooth out. Creates initial burst of visibility with sustained delivery.
            </p>
            <div style="background: #f1f3f4; padding: 12px; border-radius: 4px; margin-bottom: 12px;">
                <div style="font-size: 11px; color: #5f6368; margin-bottom: 4px;"><strong>Curve</strong></div>
                <div style="font-size: 13px; color: #202124;">50% â†’ 25% â†’ 25% (by thirds)</div>
            </div>
            <div style="font-size: 12px; color: #5f6368;">
                âœ“ Early visibility burst<br>
                âœ“ Catch attention first<br>
                âœ“ Best for launches/events
            </div>
        </div>

        <!-- ASAP PACING -->
        <div style="border: 2px solid #dadce0; border-radius: 8px; padding: 20px;">
            <div style="font-size: 32px; margin-bottom: 12px;">âš¡</div>
            <h3 style="margin: 0 0 12px 0; font-size: 15px; font-weight: 600;">ASAP Pacing</h3>
            <p style="font-size: 13px; color: #5f6368; margin: 0 0 16px 0; line-height: 1.6;">
                Deliver as fast as possible while respecting frequency caps. Maximizes impression velocity with no artificial delays.
            </p>
            <div style="background: #f1f3f4; padding: 12px; border-radius: 4px; margin-bottom: 12px;">
                <div style="font-size: 11px; color: #5f6368; margin-bottom: 4px;"><strong>Speed</strong></div>
                <div style="font-size: 13px; color: #202124;">Maximum available inventory</div>
            </div>
            <div style="font-size: 12px; color: #5f6368;">
                âœ“ Fastest delivery<br>
                âœ“ Complete quickly<br>
                âœ“ Best for limited inventory
            </div>
        </div>
    </div>
</div>

<!-- ACTIVE PACING CONFIGURATIONS -->
<div class="card" style="margin-top: 24px;">
    <h2>ğŸ“ˆ Active Pacing Configurations</h2>
    <p class="subtitle">Current delivery speed & cap settings across all line items</p>
    
    <div style="margin-top: 16px; overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
            <thead>
                <tr style="border-bottom: 2px solid #dadce0;">
                    <th style="text-align: left; padding: 12px 0; font-weight: 600; color: #202124;">Line Item</th>
                    <th style="text-align: center; padding: 12px 0; font-weight: 600; color: #202124;">Strategy</th>
                    <th style="text-align: center; padding: 12px 0; font-weight: 600; color: #202124;">Daily Cap</th>
                    <th style="text-align: center; padding: 12px 0; font-weight: 600; color: #202124;">Lifetime Cap</th>
                    <th style="text-align: right; padding: 12px 0; font-weight: 600; color: #202124;">Today's Delivery</th>
                    <th style="text-align: right; padding: 12px 0; font-weight: 600; color: #202124;">Total Delivered</th>
                    <th style="text-align: center; padding: 12px 0; font-weight: 600; color: #202124;">Status</th>
                </tr>
            </thead>
            <tbody>
                <!-- Line Item 1: Even Pacing, On Target -->
                <tr style="border-bottom: 1px solid #e8eaed;">
                    <td style="padding: 12px 0; color: #202124;"><strong>Brand Co - Homepage</strong></td>
                    <td style="text-align: center;">
                        <span style="background: #e8f0fe; color: #1967d2; padding: 4px 8px; border-radius: 3px; font-size: 12px; font-weight: 500;">ğŸ“Š Even</span>
                    </td>
                    <td style="text-align: center; color: #5f6368;">
                        <div>100K</div>
                        <div style="font-size: 11px; color: #9aa0a6;">(100K booked)</div>
                    </td>
                    <td style="text-align: center; color: #5f6368;">
                        <div>5M</div>
                        <div style="font-size: 11px; color: #9aa0a6;">(5M total)</div>
                    </td>
                    <td style="text-align: right; color: #202124;"><strong>98,530</strong></td>
                    <td style="text-align: right; color: #202124;"><strong>4.92M</strong></td>
                    <td style="text-align: center;">
                        <span style="background: #e6f4ea; color: #137333; padding: 4px 8px; border-radius: 3px; font-size: 12px; font-weight: 500;">ğŸ“ˆ On Target</span>
                    </td>
                </tr>

                <!-- Line Item 2: Frontloaded, Behind -->
                <tr style="border-bottom: 1px solid #e8eaed;">
                    <td style="padding: 12px 0; color: #202124;"><strong>Tech Inc - Video</strong></td>
                    <td style="text-align: center;">
                        <span style="background: #fff3e0; color: #f57c00; padding: 4px 8px; border-radius: 3px; font-size: 12px; font-weight: 500;">ğŸš€ Frontloaded</span>
                    </td>
                    <td style="text-align: center; color: #5f6368;">
                        <div>250K</div>
                        <div style="font-size: 11px; color: #9aa0a6;">(early burst)</div>
                    </td>
                    <td style="text-align: center; color: #5f6368;">
                        <div>2M</div>
                        <div style="font-size: 11px; color: #9aa0a6;">(2M total)</div>
                    </td>
                    <td style="text-align: right; color: #202124;"><strong>180,234</strong></td>
                    <td style="text-align: right; color: #202124;"><strong>1.22M</strong></td>
                    <td style="text-align: center;">
                        <span style="background: #ffebee; color: #c5221f; padding: 4px 8px; border-radius: 3px; font-size: 12px; font-weight: 500;">ğŸ“‰ Lagging</span>
                    </td>
                </tr>

                <!-- Line Item 3: ASAP, Over-Delivering -->
                <tr style="border-bottom: 1px solid #e8eaed;">
                    <td style="padding: 12px 0; color: #202124;"><strong>Startup Labs - Display</strong></td>
                    <td style="text-align: center;">
                        <span style="background: #f3e5f5; color: #6a1b9a; padding: 4px 8px; border-radius: 3px; font-size: 12px; font-weight: 500;">âš¡ ASAP</span>
                    </td>
                    <td style="text-align: center; color: #5f6368;">
                        <div>Unlimited</div>
                        <div style="font-size: 11px; color: #9aa0a6;">(max speed)</div>
                    </td>
                    <td style="text-align: center; color: #5f6368;">
                        <div>500K</div>
                        <div style="font-size: 11px; color: #9aa0a6;">(500K total)</div>
                    </td>
                    <td style="text-align: right; color: #202124;"><strong>125,890</strong></td>
                    <td style="text-align: right; color: #202124;"><strong>485,320</strong></td>
                    <td style="text-align: center;">
                        <span style="background: #fff3e0; color: #f57c00; padding: 4px 8px; border-radius: 3px; font-size: 12px; font-weight: 500;">âš ï¸ Over-Delivering</span>
                    </td>
                </tr>

                <!-- Line Item 4: Even with Catch-up -->
                <tr style="border-bottom: 1px solid #e8eaed;">
                    <td style="padding: 12px 0; color: #202124;"><strong>Finance Corp - Sidebar</strong></td>
                    <td style="text-align: center;">
                        <span style="background: #e8f0fe; color: #1967d2; padding: 4px 8px; border-radius: 3px; font-size: 12px; font-weight: 500;">ğŸ“Š Even</span>
                    </td>
                    <td style="text-align: center; color: #5f6368;">
                        <div>75K</div>
                        <div style="font-size: 11px; color: #9aa0a6;">+ catch-up enabled</div>
                    </td>
                    <td style="text-align: center; color: #5f6368;">
                        <div>1.5M</div>
                        <div style="font-size: 11px; color: #9aa0a6;">(1.5M total)</div>
                    </td>
                    <td style="text-align: right; color: #202124;"><strong>82,100</strong></td>
                    <td style="text-align: right; color: #202124;"><strong>1.18M</strong></td>
                    <td style="text-align: center;">
                        <span style="background: #fff3e0; color: #f57c00; padding: 4px 8px; border-radius: 3px; font-size: 12px; font-weight: 500;">ğŸ”„ Catch-Up Active</span>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- DELIVERY PERFORMANCE CHARTS -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); gap: 24px; margin-top: 24px;">
    <!-- ON-TARGET LINE ITEM -->
    <div class="card">
        <h3 style="margin: 0 0 16px 0; font-size: 15px; font-weight: 600;">ğŸ“Š Brand Co - Even Pacing (On Target)</h3>
        
        <div style="margin-bottom: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                <span style="font-size: 12px; font-weight: 500; color: #202124;">Overall Progress</span>
                <span style="font-size: 12px; color: #5f6368;">4.92M / 5M (98%)</span>
            </div>
            <div style="height: 8px; background: #e8eaed; border-radius: 4px; overflow: hidden;">
                <div style="height: 100%; background: linear-gradient(90deg, #34a853, #81c995); width: 98%; border-radius: 4px;"></div>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px;">
            <div style="background: #e6f4ea; padding: 12px; border-radius: 4px; border-left: 3px solid #34a853;">
                <div style="font-size: 11px; color: #137333; font-weight: 600; margin-bottom: 4px;">Delivered Today</div>
                <div style="font-size: 15px; font-weight: 600; color: #202124;">98.5K</div>
                <div style="font-size: 10px; color: #137333;">vs 100K target âœ“</div>
            </div>
            <div style="background: #f1f3f4; padding: 12px; border-radius: 4px;">
                <div style="font-size: 11px; color: #5f6368; font-weight: 600; margin-bottom: 4px;">Days Remaining</div>
                <div style="font-size: 15px; font-weight: 600; color: #202124;">7 days</div>
                <div style="font-size: 10px; color: #5f6368;">Complete on schedule</div>
            </div>
        </div>

        <div style="background: #f1f3f4; padding: 12px; border-radius: 4px;">
            <div style="font-size: 11px; font-weight: 600; color: #202124; margin-bottom: 8px;">ğŸ“… Estimated Completion</div>
            <div style="font-size: 13px; color: #202124; margin-bottom: 4px;">January 10, 2026 (on schedule)</div>
            <div style="font-size: 11px; color: #5f6368;">Current pace: 98.5K/day</div>
        </div>
    </div>

    <!-- LAGGING LINE ITEM -->
    <div class="card">
        <h3 style="margin: 0 0 16px 0; font-size: 15px; font-weight: 600;">ğŸš€ Tech Inc - Frontloaded (Lagging)</h3>
        
        <div style="margin-bottom: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                <span style="font-size: 12px; font-weight: 500; color: #202124;">Overall Progress</span>
                <span style="font-size: 12px; color: #5f6368;">1.22M / 2M (61%)</span>
            </div>
            <div style="height: 8px; background: #e8eaed; border-radius: 4px; overflow: hidden;">
                <div style="height: 100%; background: linear-gradient(90deg, #fbbc04, #fdd835); width: 61%; border-radius: 4px;"></div>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px;">
            <div style="background: #fff3e0; padding: 12px; border-radius: 4px; border-left: 3px solid #fbbc04;">
                <div style="font-size: 11px; color: #f57c00; font-weight: 600; margin-bottom: 4px;">Delivered Today</div>
                <div style="font-size: 15px; font-weight: 600; color: #202124;">180.2K</div>
                <div style="font-size: 10px; color: #f57c00;">vs 250K target âš ï¸</div>
            </div>
            <div style="background: #f1f3f4; padding: 12px; border-radius: 4px;">
                <div style="font-size: 11px; color: #5f6368; font-weight: 600; margin-bottom: 4px;">Days Remaining</div>
                <div style="font-size: 15px; font-weight: 600; color: #202124;">7 days</div>
                <div style="font-size: 10px; color: #d33527;">At risk of under-delivery</div>
            </div>
        </div>

        <div style="background: #fff3e0; padding: 12px; border-radius: 4px; border-left: 3px solid #fbbc04;">
            <div style="font-size: 11px; font-weight: 600; color: #d33527; margin-bottom: 8px;">ğŸ”„ Catch-Up Action Needed</div>
            <div style="font-size: 13px; color: #202124; margin-bottom: 4px;">Increase daily cap to 290K/day</div>
            <div style="font-size: 11px; color: #5f6368;">To deliver remaining 780K in 7 days</div>
        </div>
    </div>
</div>

<!-- PACING CONTROLS & SETTINGS -->
<div class="card" style="margin-top: 24px;">
    <h2>âš™ï¸ Configure Pacing Rules</h2>
    <p class="subtitle">Set up daily caps, lifetime caps, and catch-up delivery</p>
    
    <div style="margin-top: 20px; border-top: 1px solid #e8eaed; padding-top: 20px;">
        <h3 style="margin: 0 0 16px 0; font-size: 14px; font-weight: 600; color: #202124;">Daily Impression Caps</h3>
        <div style="background: #f1f3f4; padding: 16px; border-radius: 8px; margin-bottom: 20px;">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                <div>
                    <label style="display: block; font-weight: 500; color: #202124; margin-bottom: 8px; font-size: 12px;">Maximum Daily Impressions</label>
                    <input type="number" placeholder="e.g., 100000" style="width: 100%; padding: 10px; border: 1px solid #dadce0; border-radius: 4px; font-size: 13px;" value="100000">
                    <div style="font-size: 11px; color: #5f6368; margin-top: 4px;">Set 0 for unlimited</div>
                </div>
                <div>
                    <label style="display: block; font-weight: 500; color: #202124; margin-bottom: 8px; font-size: 12px;">Time Zone</label>
                    <select style="width: 100%; padding: 10px; border: 1px solid #dadce0; border-radius: 4px; font-size: 13px;">
                        <option>UTC</option>
                        <option>US/Eastern</option>
                        <option>US/Central</option>
                        <option>US/Mountain</option>
                        <option>US/Pacific</option>
                    </select>
                </div>
            </div>
            <div style="font-size: 12px; color: #5f6368; margin-top: 12px; padding: 12px; background: #fff; border-radius: 4px;">
                ğŸ“Œ Daily cap resets at midnight in the selected timezone
            </div>
        </div>

        <h3 style="margin: 0 0 16px 0; font-size: 14px; font-weight: 600; color: #202124;">Lifetime Impression Caps</h3>
        <div style="background: #f1f3f4; padding: 16px; border-radius: 8px; margin-bottom: 20px;">
            <div>
                <label style="display: block; font-weight: 500; color: #202124; margin-bottom: 8px; font-size: 12px;">Maximum Lifetime Impressions</label>
                <input type="number" placeholder="e.g., 5000000" style="width: 100%; padding: 10px; border: 1px solid #dadce0; border-radius: 4px; font-size: 13px;" value="5000000">
                <div style="font-size: 11px; color: #5f6368; margin-top: 4px;">Line item stops serving once reached</div>
            </div>
        </div>

        <h3 style="margin: 0 0 16px 0; font-size: 14px; font-weight: 600; color: #202124;">Catch-Up Delivery Logic</h3>
        <div style="background: #f1f3f4; padding: 16px; border-radius: 8px;">
            <label style="display: flex; align-items: flex-start; margin-bottom: 12px; cursor: pointer;">
                <input type="checkbox" checked style="margin-right: 12px; margin-top: 2px;">
                <div>
                    <div style="font-weight: 500; color: #202124; font-size: 13px;">Enable Catch-Up Delivery</div>
                    <div style="font-size: 11px; color: #5f6368; margin-top: 4px;">If behind schedule, automatically increase daily cap to catch up</div>
                </div>
            </label>
            
            <div style="margin-top: 12px; padding: 12px; background: #fff; border-radius: 4px; border-left: 3px solid #1967d2;">
                <div style="font-size: 12px; font-weight: 500; color: #1967d2; margin-bottom: 4px;">ğŸ”„ How It Works</div>
                <ul style="font-size: 11px; color: #5f6368; margin: 0; padding-left: 16px; line-height: 1.6;">
                    <li>Compares daily delivery to expected pace</li>
                    <li>If behind by >5%, increases daily cap by 10%</li>
                    <li>Automatically adjusts to recover within 2 days</li>
                    <li>Respects frequency caps and inventory limits</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- DELIVERY WARNINGS & ALERTS -->
<div class="card" style="margin-top: 24px;">
    <h2>âš ï¸ Delivery Warnings & Alerts</h2>
    <p class="subtitle">Issues detected in current delivery performance</p>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 16px; margin-top: 16px;">
        <!-- Under-Delivery Warning -->
        <div style="background: #fff3e0; border: 1px solid #fbbc04; border-radius: 8px; padding: 16px;">
            <div style="display: flex; align-items: flex-start; gap: 12px;">
                <div style="font-size: 24px;">âš ï¸</div>
                <div style="flex: 1;">
                    <h4 style="margin: 0 0 4px 0; color: #f57c00; font-weight: 600;">Under-Delivery Risk</h4>
                    <p style="margin: 0 0 8px 0; font-size: 12px; color: #5f6368;">
                        Tech Inc - Video line item is 39% behind schedule
                    </p>
                    <button style="background: #fbbc04; color: #fff; border: none; padding: 6px 12px; border-radius: 3px; cursor: pointer; font-size: 12px; font-weight: 500;">Adjust Pacing â†’</button>
                </div>
            </div>
        </div>

        <!-- Over-Delivery Warning -->
        <div style="background: #ffebee; border: 1px solid #d33527; border-radius: 8px; padding: 16px;">
            <div style="display: flex; align-items: flex-start; gap: 12px;">
                <div style="font-size: 24px;">ğŸ”´</div>
                <div style="flex: 1;">
                    <h4 style="margin: 0 0 4px 0; color: #d33527; font-weight: 600;">Over-Delivery</h4>
                    <p style="margin: 0 0 8px 0; font-size: 12px; color: #5f6368;">
                        Startup Labs - Display has delivered 97% of lifetime cap already
                    </p>
                    <button style="background: #d33527; color: #fff; border: none; padding: 6px 12px; border-radius: 3px; cursor: pointer; font-size: 12px; font-weight: 500;">Pause Line Item â†’</button>
                </div>
            </div>
        </div>

        <!-- Completion Forecast -->
        <div style="background: #e6f4ea; border: 1px solid #34a853; border-radius: 8px; padding: 16px;">
            <div style="display: flex; align-items: flex-start; gap: 12px;">
                <div style="font-size: 24px;">âœ…</div>
                <div style="flex: 1;">
                    <h4 style="margin: 0 0 4px 0; color: #137333; font-weight: 600;">On Schedule</h4>
                    <p style="margin: 0 0 8px 0; font-size: 12px; color: #5f6368;">
                        Brand Co - Homepage will complete on January 10, 2026
                    </p>
                    <div style="font-size: 11px; color: #137333;">No action needed</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- CATCH-UP DELIVERY FORMULA -->
<div class="card" style="margin-top: 24px;">
    <h2>ğŸ§® How Catch-Up Delivery Works</h2>
    
    <div style="background: #f1f3f4; padding: 20px; border-radius: 8px; margin-top: 16px;">
        <div style="margin-bottom: 20px;">
            <h4 style="margin: 0 0 12px 0; color: #202124; font-size: 13px; font-weight: 600;">ğŸ“Š Calculation Steps</h4>
            <div style="background: #fff; padding: 16px; border-radius: 4px; font-size: 12px; line-height: 1.8; color: #5f6368; font-family: monospace;">
                <div><strong style="color: #202124;">Step 1: Calculate Pace</strong></div>
                <div style="margin-left: 16px; margin-bottom: 12px;">Expected Daily = Booked Impressions Ã· Days Remaining</div>
                
                <div><strong style="color: #202124;">Step 2: Check Delivery</strong></div>
                <div style="margin-left: 16px; margin-bottom: 12px;">Actual Daily = Impressions Delivered Today</div>
                
                <div><strong style="color: #202124;">Step 3: Calculate Variance</strong></div>
                <div style="margin-left: 16px; margin-bottom: 12px;">Variance = (Actual - Expected) Ã· Expected</div>
                
                <div><strong style="color: #202124;">Step 4: Adjust Cap</strong></div>
                <div style="margin-left: 16px;">If Variance < -5%: Daily Cap Ã— (1 + |Variance| Ã— 2)</div>
                <div style="margin-left: 16px;">If Variance > 5%: Reduce daily cap proportionally</div>
            </div>
        </div>

        <div style="background: #e8f0fe; padding: 16px; border-radius: 4px; margin-top: 12px;">
            <div style="font-size: 12px; color: #1967d2;">
                <strong>Example:</strong> If a line item needs 1M impressions in 10 days (100K/day) but only delivered 50K today (50% behind), catch-up would increase the daily cap to 110K to recover within deadline.
            </div>
        </div>
    </div>
</div>
{% endblock %}
